<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>blogs · srikar boddupally</title>
    <link rel="icon" type="image/png" href="../notion_7.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Space Mono Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Space Mono', monospace;
        }

        ::selection {
            background: #dafbe1;
            color: #1a7f37;
        }

        /* Markdown Styles */
        .markdown-body h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            margin-top: 2rem;
        }

        .markdown-body h2 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.75rem;
            margin-top: 1.5rem;
        }

        .markdown-body h3 {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            margin-top: 1.25rem;
        }

        .markdown-body p {
            margin-bottom: 1rem;
            line-height: 1.7;
            color: #374151;
        }

        .markdown-body ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .markdown-body pre {
            background: #f4f4f5;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .markdown-body code {
            background: #f4f4f5;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85em;
        }

        .markdown-body pre code {
            background: transparent;
            padding: 0;
        }

        .markdown-body a {
            color: #15803d;
            text-decoration: underline;
        }

        .markdown-body blockquote {
            border-left: 4px solid #e5e7eb;
            padding-left: 1rem;
            color: #9ca3af;
            font-style: italic;
        }
    </style>
</head>

<body class="bg-white text-zinc-900 max-w-3xl mx-auto px-6 py-12 md:py-20 selection:bg-green-100 text-sm md:text-base">

    <header class="flex justify-between items-baseline mb-16">
        <h1 class="font-bold tracking-tight">
            <a href="../index.html" class="hover:text-green-700 transition-colors">srikar boddupally</a>
            <span class="text-zinc-400 mx-2">/</span>
            <span class="text-zinc-900">blogs</span>
        </h1>
    </header>

    <main id="app">
        <div class="text-zinc-400 animate-pulse">loading registry...</div>
    </main>

    <script>
        const app = document.getElementById('app');

        // Debug helper
        function logError(msg, err) {
            console.error(msg, err);
            const errDiv = document.createElement('div');
            errDiv.className = "text-red-500 text-xs font-mono mt-4 border-t border-red-100 pt-2";
            errDiv.innerText = `DEBUG: ${msg} \n${err ? err.message : ''}`;
            app.appendChild(errDiv);
        }

        async function loadRegistry() {
            try {
                console.log("Fetching posts.json...");
                const res = await fetch('./posts.json');
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                console.log("Registry loaded:", data);
                return data;
            } catch (e) {
                logError("Failed to load posts registry", e);
                return [];
            }
        }

        async function renderList() {
            const posts = await loadRegistry();
            if (posts.length === 0) {
                app.innerHTML = `<div class="text-zinc-500">no posts found (or failed to load).</div>`;
                return;
            }

            const listHtml = posts.map(post => `
                <article class="mb-10 group">
                    <div class="flex flex-col md:flex-row md:items-baseline md:justify-between mb-2">
                        <h2 class="text-lg font-bold">
                            <a href="#${post.id}" class="hover:text-green-700 transition-colors">${post.title}</a>
                        </h2>
                        <span class="text-xs text-zinc-400 font-mono">${post.date}</span>
                    </div>
                    <p class="text-zinc-500 leading-relaxed text-sm">${post.summary}</p>
                </article>
            `).join('');

            app.innerHTML = `<div class="space-y-4">${listHtml}</div>`;
            document.title = "blogs · srikar boddupally";
        }

        async function renderPost(id) {
            const posts = await loadRegistry();
            const post = posts.find(p => p.id === id);

            if (!post) {
                app.innerHTML = `<div class="text-red-500">post ${id} not found in registry. <a href="#" class="underline">go back</a></div>`;
                return;
            }

            try {
                console.log(`Fetching post content: posts/${post.file}`);
                const res = await fetch(`posts/${post.file}`);
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const text = await res.text();

                // Strip the YAML metadata block from the top of the markdown file
                const cleanText = text.replace(/^---\r?\n[\s\S]*?\r?\n---\r?\n/, '');

                if (typeof marked === 'undefined') {
                    throw new Error("marked.js library not loaded");
                }

                // Parse the cleaned text (Only declared once!)
                const content = marked.parse(cleanText);

                app.innerHTML = `
                    <div class="mb-8">
                        <a href="#" class="text-xs text-zinc-400 hover:text-green-700 transition-colors">← back to all posts</a>
                    </div>
                    <article>
                        <header class="mb-10 pb-8 border-b border-zinc-100">
                            <h1 class="text-2xl md:text-3xl font-bold mb-3">${post.title}</h1>
                            <time class="text-xs text-zinc-400 font-mono">${post.date}</time>
                        </header>
                        <div class="markdown-body">
                            ${content}
                        </div>
                    </article>
                `;
                document.title = `${post.title} · srikar boddupally`;
            } catch (e) {
                app.innerHTML = `<div class="text-red-500">error loading post content.</div>`;
                logError("Content fetch failed", e);
            }
        }

        async function router() {
            const hash = window.location.hash.slice(1);
            if (hash) {
                await renderPost(hash);
            } else {
                await renderList();
            }
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', router);
    </script>
</body>

</html>